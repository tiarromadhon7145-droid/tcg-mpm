<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transformation Card Game - Steampunk Desert</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    /* --- CSS UTAMA (DEFAULT: BIRU / AMAN) --- */
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      /* Background Biru (Default) */
      background: linear-gradient(135deg, #0a1e3d 0%, #1a3a5c 50%, #0a1e3d 100%);
      color: #e8f4f8;
      overflow-x: hidden;
      width: 100%;
      height: 100%;
      position: relative;
      transition: background 1.5s ease-in-out; 
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 50% 50%, rgba(20, 120, 180, 0.1) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
      transition: background 1.5s ease;
    }

    /* --- [FITUR 1] MODE WASPADA (HP <= 5000) --- */
    body.warning-mode {
      background: linear-gradient(135deg, #3e2723 0%, #5d4037 50%, #3e2723 100%) !important;
    }
    body.warning-mode::before {
      background: radial-gradient(circle at 50% 50%, rgba(255, 160, 0, 0.15) 0%, transparent 70%);
    }
    body.warning-mode .game-header {
      background: rgba(93, 64, 55, 0.4);
      border-color: #ffb300;
    }
    body.warning-mode .game-header::after { color: #ffb300; }
    body.warning-mode .playmat {
      background: #281815;
      border-color: #ffd54f;
    }
    body.warning-mode .card { background: #3e2723; border-color: #ffca28; }
    body.warning-mode .hp-value { color: #ffd54f; }

    /* --- [FITUR BARU] GOLDEN MODE (SKOR >= 4000) --- */
    /* --- [FITUR BARU] CROWN MODE (SKOR >= 6000) --- */
    body.crown-mode {
      background: linear-gradient(135deg, #240b36 0%, #c31432 100%) !important; /* Royal Purple/Red */
    }
    
    body.crown-mode::before {
      background: radial-gradient(circle at 50% 50%, rgba(255, 215, 0, 0.15) 0%, transparent 60%);
    }

    body.crown-mode .game-header {
      background: rgba(44, 24, 16, 0.6);
      border: 3px solid #ffd700; /* Emas Solid */
      box-shadow: 0 0 25px rgba(255, 215, 0, 0.7);
    }
    
    body.crown-mode .game-title {
       color: #ffd700;
       text-shadow: 0 2px 0 #000, 0 0 20px #ff00de;
    }

    /* ORNAMEN MAHKOTA PADA PLAYMAT */
    body.crown-mode .playmat {
      background: #1a0b2e;
      border: 4px double #ffd700; /* Double border emas */
      box-shadow: 0 0 60px rgba(255, 215, 0, 0.4), inset 0 0 30px rgba(0,0,0,0.8);
      position: relative;
    }

    /* Ikon Mahkota di atas Playmat */
    body.crown-mode .playmat::before {
      content: 'üëë';
      position: absolute;
      top: -55px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 80px;
      z-index: 100;
      filter: drop-shadow(0 0 15px gold);
      animation: crownFloat 2s ease-in-out infinite;
    }

    /* Efek Berkilau pada Border */
    body.crown-mode .playmat::after {
      content: '';
      position: absolute;
      top: -10px; left: -10px; right: -10px; bottom: -10px;
      border: 2px dashed rgba(255, 215, 0, 0.5);
      border-radius: 25px;
      z-index: -1;
      animation: spinBorder 20s linear infinite;
    }

    @keyframes crownFloat {
      0%, 100% { transform: translateX(-50%) translateY(0) rotate(0deg); }
      50% { transform: translateX(-50%) translateY(-10px) rotate(5deg); }
    }

    @keyframes spinBorder {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    body.crown-mode .card {
        border-color: #ffd700;
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
    }
    
    body.crown-mode .score-display {
        background: #ffd700;
        color: #240b36;
        border: 2px solid #fff;
        box-shadow: 0 0 25px #ffd700;
        font-size: 24px;
        transform: scale(1.1);
    }
    body.golden-mode {
      background: linear-gradient(135deg, #bf5f00 0%, #e6b800 50%, #bf5f00 100%) !important;
    }
    body.golden-mode::before {
      background: radial-gradient(circle at 50% 50%, rgba(255, 215, 0, 0.2) 0%, transparent 70%);
    }
    body.golden-mode .game-header {
      background: rgba(184, 134, 11, 0.4);
      border-color: #fff700;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
    }
    body.golden-mode .game-title {
        text-shadow: 0 0 10px rgba(255, 255, 0, 0.8);
        color: #fff;
    }
    body.golden-mode .playmat {
      background: #422a00;
      border-color: #ffeb3b;
      box-shadow: 0 10px 40px rgba(0,0,0,0.8), 0 0 30px rgba(255, 215, 0, 0.3);
    }
    body.golden-mode .card {
        background: #5c3c00;
        border-color: #ffeb3b;
    }
    body.golden-mode .card-title { color: #fff176; }
    body.golden-mode .score-display {
        background: #fffde7;
        color: #f57f17;
        border-color: #fbc02d;
        box-shadow: 0 0 20px rgba(255, 193, 7, 0.8);
    }

    /* --- [FITUR 2] MODE KRITIS (HP <= 2500) --- */
    body.critical-mode {
      background: linear-gradient(135deg, #3b0000 0%, #590000 50%, #2a0000 100%) !important;
    }
    body.critical-mode::before {
      background: radial-gradient(circle at 50% 50%, rgba(255, 0, 0, 0.2) 0%, transparent 70%);
      animation: criticalPulse 2s infinite;
    }
    @keyframes criticalPulse {
        0% { opacity: 0.5; }
        50% { opacity: 1; }
        100% { opacity: 0.5; }
    }
    body.critical-mode .game-header {
      background: rgba(89, 0, 0, 0.6);
      border-color: #ff0000;
    }
    body.critical-mode .playmat {
      background: #1a0000;
      border-color: #ff4444;
    }
    body.critical-mode .card { 
        background: #2b0000; 
        border-color: #ff4444; 
    }
    body.critical-mode .hp-value { color: #ff4444; }

    /* --- END CSS MODES --- */

    .game-container {
      width: 100%;
      min-height: 100%;
      padding: 10px;
      position: relative;
    }

    @media (max-width: 768px) {
      .game-container {
        padding: 5px;
      }
    }

    .game-header {
      text-align: center;
      margin-bottom: 20px;
      padding: 20px;
      background: rgba(20, 120, 180, 0.3);
      border: 2px solid rgba(20, 120, 180, 0.5);
      border-radius: 16px;
      position: relative;
      transition: all 1s ease;
    }
    
    .game-header::after {
      content: '‚öì';
      position: absolute;
      font-size: 120px;
      opacity: 0.05;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #5fc3e8;
      z-index: 0;
    }

    .game-title {
      font-size: 32px;
      margin: 0;
      color: #ffffff;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
      letter-spacing: 2px;
      font-weight: 700;
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    
    .game-title::before,
    .game-title::after {
      content: '‚óà';
      font-size: 20px;
      color: #5fc3e8;
      opacity: 0.8;
    }

    @media (max-width: 768px) {
      .game-title {
        font-size: 20px;
        letter-spacing: 1px;
      }

      .game-header p {
        font-size: 11px;
      }
    }

    .playmat {
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      background: #0d2847;
      border: 2px solid rgba(20, 120, 180, 0.4);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
      position: relative;
      transition: all 1s ease;
    }

    @media (max-width: 768px) {
      .playmat {
        padding: 10px;
        border-width: 2px;
        border-radius: 16px;
      }
    }

    .playmat-content {
      position: relative;
      z-index: 1;
    }

    .hp-bars {
      display: flex;
      justify-content: space-between;
      margin-bottom: 25px;
      gap: 20px;
    }

    @media (max-width: 768px) {
      .hp-bars {
        gap: 10px;
        margin-bottom: 15px;
      }
    }

    .hp-container {
      flex: 1;
      background: rgba(20, 120, 180, 0.2);
      border: 2px solid rgba(20, 120, 180, 0.4);
      border-radius: 16px;
      padding: 15px;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .hp-container.damage {
      animation: damageShake 0.5s ease-in-out, damageFlash 0.5s ease-in-out;
    }
    
    @keyframes damageShake {
      0%, 100% { transform: translateX(0) translateY(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-8px) translateY(-3px); }
      20%, 40%, 60%, 80% { transform: translateX(8px) translateY(3px); }
    }
    
    @keyframes damageFlash {
      0%, 100% { border-color: rgba(20, 120, 180, 0.4); }
      50% { border-color: #ff6b35; box-shadow: 0 0 30px rgba(255, 107, 53, 0.5); }
    }

    .hp-container::before {
      content: '‚öì';
      position: absolute;
      font-size: 80px;
      opacity: 0.08;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: #5fc3e8;
    }

    .hp-label {
      font-size: 14px;
      font-weight: 600;
      color: #7dd3f0;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      position: relative;
      z-index: 1;
    }

    .hp-value {
      font-size: 36px;
      font-weight: 700;
      color: #ffffff;
      position: relative;
      z-index: 1;
      transition: all 0.3s ease;
    }
    
    .hp-value.hit {
      animation: hpPulse 0.5s ease-in-out;
    }
    
    @keyframes hpPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.3); color: #ff6b35; }
    }
    
    .damage-number {
      position: absolute;
      font-size: 32px;
      font-weight: bold;
      color: #ff6b35;
      text-shadow: 0 0 5px rgba(0,0,0,0.8);
      z-index: 100;
      pointer-events: none;
      animation: damageFloat 1.5s ease-out forwards;
    }
    
    @keyframes damageFloat {
      0% { opacity: 1; transform: translateY(0) scale(0.5); }
      100% { opacity: 0; transform: translateY(-80px) scale(0.8); }
    }
    
    .heal-number {
      position: absolute;
      font-size: 32px;
      font-weight: bold;
      color: #4caf50;
      z-index: 100;
      pointer-events: none;
      animation: healFloat 1.5s ease-out forwards;
    }
    
    @keyframes healFloat {
      0% { opacity: 1; transform: translateY(0) scale(0.5); }
      100% { opacity: 0; transform: translateY(-80px) scale(0.8); }
    }

    @media (max-width: 768px) {
      .hp-container { padding: 10px; }
      .hp-label { font-size: 12px; margin-bottom: 5px; }
      .hp-value { font-size: 24px; }
      .hp-container::before { font-size: 50px; }
    }

    .main-game-area {
      display: grid;
      grid-template-columns: 200px 1fr 200px;
      gap: 20px;
      margin-bottom: 25px;
    }

    @media (max-width: 768px) {
      .main-game-area {
        grid-template-columns: 1fr;
        gap: 10px;
        margin-bottom: 15px;
      }
    }

    .deck-zone, .graveyard-zone {
      background: rgba(20, 120, 180, 0.1);
      border: 2px solid rgba(20, 120, 180, 0.3);
      border-radius: 16px;
      padding: 15px;
      text-align: center;
      min-height: 250px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      transition: all 1s ease;
    }

    @media (max-width: 768px) {
      .deck-zone, .graveyard-zone {
        min-height: 150px;
        padding: 10px;
        border-width: 2px;
      }
      .zone-title {
        font-size: 13px;
        margin-bottom: 10px;
      }
    }

    .zone-title {
      font-size: 14px;
      font-weight: 600;
      color: #7dd3f0;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .deck-stack {
      width: 120px;
      height: 170px;
      background: #1a3a5c;
      border: 2px solid rgba(95, 195, 232, 0.4);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    @media (max-width: 768px) {
      .deck-stack { width: 80px; height: 110px; }
      .deck-stack::before { font-size: 40px; }
      .deck-count { font-size: 11px; padding: 3px 8px; }
    }

    .deck-stack:hover {
      transform: translateY(-5px);
      border-color: rgba(95, 195, 232, 0.8);
    }

    .deck-stack::before {
      content: 'üè¥‚Äç‚ò†Ô∏è';
      font-size: 60px;
      opacity: 0.7;
    }

    .deck-count {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: #1478b4;
      color: #ffffff;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
    }

    .field-area {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .card-zones {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }

    .card-slot {
      background: rgba(20, 120, 180, 0.1);
      border: 2px dashed rgba(95, 195, 232, 0.3);
      border-radius: 12px;
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 10px;
      transition: all 0.3s ease;
    }
    
    .card-slot:hover {
      background: rgba(20, 120, 180, 0.2);
    }

    @media (max-width: 768px) {
      .card-zones { grid-template-columns: 1fr; gap: 10px; }
      .card-slot { min-height: 150px; padding: 5px; }
      .card-slot-label { font-size: 10px; top: 5px; left: 5px; }
    }

    .card-slot-label {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 11px;
      color: #7dd3f0;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .hand-area {
      background: rgba(20, 120, 180, 0.2);
      border: 2px solid rgba(20, 120, 180, 0.4);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      transition: all 1s ease;
    }

    @media (max-width: 768px) {
      .hand-area { padding: 10px; border-width: 2px; margin-bottom: 15px; }
      .hand-title { font-size: 14px; }
      .hide-toggle { padding: 6px 15px; font-size: 12px; }
    }

    .hand-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .hand-title {
      font-size: 16px;
      font-weight: 600;
      color: #7dd3f0;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .hide-toggle {
      background: #1a3a5c;
      color: #ffffff;
      border: 1px solid rgba(95, 195, 232, 0.4);
      padding: 8px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s ease;
    }

    .hide-toggle:hover {
      background: #2a4a6c;
    }

    .hand-cards {
      display: flex;
      gap: 15px;
      overflow-x: auto;
      padding: 10px;
      min-height: 240px;
    }

    .hand-cards.hidden {
      filter: blur(10px);
      pointer-events: none;
    }

    .card {
      min-width: 160px;
      width: 160px;
      height: 220px;
      background: #0d2847;
      border: 2px solid rgba(95, 195, 232, 0.4);
      border-radius: 12px;
      padding: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .card::before {
      content: '‚öì';
      position: absolute;
      font-size: 120px;
      opacity: 0.06;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-15deg);
      color: #5fc3e8;
      pointer-events: none;
      z-index: 0;
    }

    @media (max-width: 768px) {
      .card { min-width: 120px; width: 120px; height: 165px; padding: 8px; border-width: 2px; }
      .card-title { font-size: 11px; margin-bottom: 5px; }
      .card-type { font-size: 9px; margin-bottom: 5px; }
      .card-content { font-size: 9px; line-height: 1.3; }
      .card-atk { font-size: 13px; margin-top: 3px; }
    }

    .card:hover {
      transform: translateY(-10px);
      border-color: #5fc3e8;
    }

    .card.selected {
      border-color: #ff6b35;
      background: #1a0d26;
    }

    .card-title {
      font-size: 13px;
      font-weight: 700;
      color: #7dd3f0;
      margin-bottom: 8px;
      text-align: center;
      border-bottom: 1px solid rgba(125, 211, 240, 0.4);
      padding-bottom: 6px;
      position: relative;
      z-index: 1;
    }

    .card-type {
      font-size: 10px;
      color: #a8e0f5;
      text-align: center;
      margin-bottom: 8px;
      font-weight: 600;
      position: relative;
      z-index: 1;
    }

    .card-content {
      flex: 1;
      font-size: 11px;
      color: #ffffff;
      overflow: hidden;
      line-height: 1.4;
      position: relative;
      z-index: 1;
    }

    .card-atk {
      text-align: right;
      font-size: 16px;
      font-weight: bold;
      color: #ff6b35;
      margin-top: 5px;
      position: relative;
      z-index: 1;
    }

    .card.spell-card {
      background: #2d1a3d;
      border-color: #9370db;
    }
    
    .card.spell-card .card-title {
      color: #9370db;
      border-bottom-color: #9370db;
    }

    .phase-controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .phase-btn {
      background: #daa520;
      color: #2c1810;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s ease;
    }

    @media (max-width: 768px) {
      .phase-controls { gap: 8px; }
      .phase-btn { padding: 10px 20px; font-size: 12px; letter-spacing: 0.5px; }
    }

    .phase-btn:hover {
      transform: translateY(-3px);
      background: #edb932;
    }

    .phase-btn:disabled {
      background: #555;
      cursor: not-allowed;
      opacity: 0.5;
    }

    .phase-btn.active {
      background: #ff6b35;
      color: white;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: #2c1810;
      border: 4px solid #daa520;
      border-radius: 15px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      /* Memastikan konten scrollable jika panjang */
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-title {
      font-size: 24px;
      color: #daa520;
      margin-bottom: 20px;
      text-transform: uppercase;
    }

    .modal-text {
      font-size: 16px;
      color: #f4e4c1;
      margin-bottom: 25px;
      line-height: 1.6;
    }

    @media (max-width: 768px) {
      .modal-content { padding: 20px; border-width: 3px; }
      .modal-title { font-size: 18px; margin-bottom: 15px; }
      .modal-text { font-size: 13px; margin-bottom: 20px; }
      .modal-btn { padding: 10px 20px; font-size: 12px; }
      .answer-input { padding: 8px; font-size: 12px; }
    }

    .modal-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
    }

    .modal-btn {
      background: #daa520;
      color: #2c1810;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
    }

    .modal-btn:hover {
      background: #edb932;
    }

    .modal-btn.cancel {
      background: #666;
      color: #fff;
    }

    .answer-input {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border: 2px solid #daa520;
      border-radius: 8px;
      background: rgba(0,0,0,0.5);
      color: #f4e4c1;
      margin-bottom: 15px;
    }

    .turn-indicator {
      text-align: center;
      padding: 15px;
      background: rgba(20,120,180,0.2);
      border: 2px solid #5fc3e8;
      border-radius: 10px;
      margin-bottom: 15px;
      font-size: 18px;
      font-weight: bold;
      color: #7dd3f0;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .turn-indicator.ai-turn {
      border-color: #ff6b35;
      color: #ff6b35;
    }

    @media (max-width: 768px) {
      .turn-indicator { padding: 10px; font-size: 14px; letter-spacing: 1px; margin-bottom: 10px; }
    }

    .log-area {
      background: #0d2847;
      border: 3px solid #1478b4;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      .log-area { padding: 10px; border-width: 2px; margin-top: 15px; }
      .log-title { font-size: 14px; }
    }

    .log-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .log-title {
      font-size: 18px;
      font-weight: bold;
      color: #7dd3f0;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .game-log {
      background: rgba(10,30,61,0.5);
      border: 2px solid rgba(20,120,180,0.3);
      border-radius: 8px;
      padding: 15px;
      max-height: 150px;
      overflow-y: auto;
    }

    .game-log.hidden {
      display: none;
    }

    @media (max-width: 768px) {
      .game-log { padding: 10px; max-height: 120px; }
      .log-entry { font-size: 11px; }
    }

    .log-entry {
      font-size: 13px;
      color: #ffffff;
      margin-bottom: 5px;
      padding: 5px;
      border-left: 3px solid #5fc3e8;
      padding-left: 10px;
    }

    .log-entry.damage {
      border-left-color: #ff6b35;
      color: #ff6b35;
    }

    .log-entry.success {
      border-left-color: #4caf50;
      color: #90ee90;
    }

    .graveyard-cards {
      display: flex;
      flex-direction: column;
      gap: 5px;
      max-height: 180px;
      overflow-y: auto;
      width: 100%;
    }

    .graveyard-card-mini {
      font-size: 10px;
      color: #7dd3f0;
      padding: 5px;
      background: rgba(20,120,180,0.15);
      border-radius: 4px;
      border-left: 2px solid #5fc3e8;
    }

    /* Intro Screen Styles (STATIC VERSION) */
    .intro-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #0a1e3d;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 1s ease-out;
    }

    .intro-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .intro-logo {
      font-size: 48px;
      font-weight: 800;
      color: #ffffff;
      text-align: center;
      margin-bottom: 20px;
      letter-spacing: 3px;
    }

    .intro-subtitle {
      font-size: 18px;
      color: #5fc3e8;
      text-align: center;
      margin-bottom: 40px;
      font-style: italic;
    }

    .intro-ship {
      font-size: 80px;
      margin-bottom: 30px;
    }

    .intro-button {
      background: #daa520;
      color: #2c1810;
      border: none;
      padding: 20px 50px;
      border-radius: 15px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 2px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
      margin-bottom: 15px; /* Added spacing for multiple buttons */
    }

    .intro-button:hover {
      transform: translateY(-5px);
      background: #edb932;
    }
    
    /* CSS Khusus untuk Tombol Tutorial yang berbeda sedikit warnanya */
    .tutorial-btn {
      background: #1478b4;
      color: white;
      font-size: 18px;
      padding: 15px 40px;
    }
    
    .tutorial-btn:hover {
        background: #1a90d4;
    }
    
    /* CSS Khusus Konten Tutorial */
    .tutorial-list {
        text-align: left;
        margin-top: 15px;
        padding-left: 20px;
    }
    .tutorial-list li {
        margin-bottom: 10px;
        color: #f4e4c1;
    }
    .tutorial-step {
        font-weight: bold;
        color: #daa520;
    }

    @media (max-width: 768px) {
      .intro-logo { font-size: 32px; letter-spacing: 2px; }
      .intro-subtitle { font-size: 14px; margin-bottom: 30px; }
      .intro-ship { font-size: 60px; margin-bottom: 20px; }
      .intro-button { padding: 15px 40px; font-size: 18px; letter-spacing: 1px; }
    }

    .game-container {
      opacity: 0;
      animation: fadeInGame 1s ease-in forwards;
      animation-delay: 0.5s;
    }

    @keyframes fadeInGame {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* LEADERBOARD CSS */
    .leaderboard-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #ff6b35;
      color: #fff;
      border: 2px solid #fff;
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      z-index: 10000;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }
    
    .leaderboard-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      color: #f4e4c1;
    }
    
    .leaderboard-table th, .leaderboard-table td {
      border: 1px solid #daa520;
      padding: 8px;
      text-align: center;
    }
    
    .leaderboard-table th {
      background: rgba(218, 165, 32, 0.2);
      color: #daa520;
    }

    .score-display {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 20px;
      font-weight: bold;
      color: #daa520;
      background: rgba(0,0,0,0.5);
      padding: 5px 15px;
      border-radius: 10px;
      border: 1px solid #daa520;
      transition: all 0.5s ease;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  
  <button class="leaderboard-btn" id="openLeaderboard">üèÜ Leaderboard</button>
  
  <div class="intro-screen" id="introScreen">
   <div class="intro-ship">
    üè¥‚Äç‚ò†Ô∏è‚öì
   </div>
   <div class="intro-logo">
    Transformation Card Game
   </div>
   <div class="intro-subtitle">
    Pirate Seas - Treasure Hunt of Mathematics
   </div>
   <button class="intro-button" id="enterGameBtn"> <span style="position: relative; z-index: 1;">‚öîÔ∏è Masuki Petualangan ‚öîÔ∏è</span> </button>
   
   <button class="intro-button tutorial-btn" id="openTutorialBtn">üìú Cara Bermain</button>
  </div>
  
  <div class="game-container" style="display: none;">
   <div class="game-header">
    <div class="score-display">Skor: <span id="currentScore">0</span></div>
    <h1 class="game-title" id="gameTitle">Transformation Card Game</h1>
    <p style="margin: 5px 0; color: #5fc3e8; font-style: italic; font-weight: 500;">Pirate Seas - Treasure Hunt of Mathematics</p>
   </div>
   <div class="playmat">
    <div class="playmat-content">
     <div class="turn-indicator" id="turnIndicator">
      Tekan Start Game
     </div>
     <div class="hp-bars">
      <div class="hp-container">
       <div class="hp-label" id="playerLabel">
        Player
       </div>
       <div class="hp-value" id="playerHP">
        10000
       </div>
      </div>
      <div class="hp-container">
       <div class="hp-label" id="aiLabel">
        Desert Guardian
       </div>
       <div class="hp-value" id="aiHP">
        10000
       </div>
      </div>
     </div>
     <div class="main-game-area">
      <div class="deck-zone">
       <div class="zone-title">
        Deck
       </div>
       <div class="deck-stack" id="deckStack">
        <div class="deck-count" id="deckCount">
         30
        </div>
       </div>
      </div>
      <div class="field-area">
       <div class="card-zones">
        <div class="card-slot" id="questionSlot"><span class="card-slot-label">Kartu Soal</span>
        </div>
        <div class="card-slot" id="spellSlot"><span class="card-slot-label">Kartu Spell</span>
        </div>
       </div>
      </div>
      <div class="graveyard-zone">
       <div class="zone-title">
        Graveyard
       </div>
       <div class="graveyard-cards" id="graveyardCards"></div>
      </div>
     </div>
     <div class="hand-area">
      <div class="hand-header">
       <div class="hand-title">
        Kartu di Tangan
       </div>
       <div style="display:flex; gap:10px;">
           <button class="hide-toggle" id="swapHandBtn" style="display:none; background:linear-gradient(135deg, #ff4081 0%, #c60055 100%); border-color:#ff80ab;">üîÑ Tukar Hand</button>
           <button class="hide-toggle" id="hideToggle">Hide Cards</button>
       </div>
      </div>
      <div class="hand-cards" id="handCards"></div>
     </div>
     <div class="phase-controls"><button class="phase-btn" id="startBtn">Start Game</button> <button class="phase-btn" id="setPhaseBtn" disabled>Set Phase</button> <button class="phase-btn" id="battlePhaseBtn" disabled>Battle Phase</button> <button class="phase-btn" id="endPhaseBtn" disabled>End Phase</button>
     </div>
     <div class="log-area">
      <div class="log-header">
       <div class="log-title">
        Log Pertandingan
       </div><button class="hide-toggle" id="logToggle">Hide Log</button>
      </div>
      <div class="game-log" id="gameLog"></div>
     </div>
    </div>
   </div>
  </div>
  
  <div class="modal" id="battleModal">
   <div class="modal-content">
    <div class="modal-title">
     ‚öîÔ∏è Battle Phase
    </div>
    <div class="modal-text">
     Apakah Anda yakin ingin melanjutkan ke Battle Phase? Jawaban Anda akan diperiksa.
    </div>
    <div class="modal-buttons"><button class="modal-btn" id="confirmBattle">Konfirmasi</button> <button class="modal-btn cancel" id="cancelBattle">Batal</button>
    </div>
   </div>
  </div>
  
  <div class="modal" id="answerModal">
   <div class="modal-content">
    <div class="modal-title" id="answerModalTitle">
     Masukkan Jawaban
    </div>
    <div class="modal-text" id="answerModalQuestion"></div><input type="text" class="answer-input" id="answerInput" placeholder="Contoh: f(x)=2x^2-4x+1">
    <div class="modal-buttons"><button class="modal-btn" id="submitAnswer">Submit</button> <button class="modal-btn cancel" id="cancelAnswer">Batal</button>
    </div>
   </div>
  </div>
  
  <div class="modal" id="leaderboardModal">
    <div class="modal-content">
      <div class="modal-title">üèÜ Top Scores</div>
      <div class="leaderboard-list" id="leaderboardList" style="margin-bottom:20px;">
        Loading data...
      </div>
      <div class="modal-buttons">
        <button class="modal-btn cancel" onclick="document.getElementById('leaderboardModal').classList.remove('active')">Tutup</button>
      </div>
    </div>
  </div>
  
  <div class="modal" id="tutorialModal">
    <div class="modal-content">
      <div class="modal-title">üìú Panduan Permainan</div>
      <div class="modal-text" style="text-align: left;">
        <p>Selamat datang Kapten! Misi Anda adalah mengalahkan Guardian dengan matematika.</p>
        <ul class="tutorial-list">
            <li><span class="tutorial-step">1. Draw Phase:</span> Anda akan otomatis menarik 1 kartu setiap awal giliran.</li>
            <li><span class="tutorial-step">2. Set Phase:</span> Pilih <strong>Kartu Soal</strong> (Wajib) dari tangan Anda untuk menyerang. Anda juga bisa menambahkan <strong>Kartu Spell</strong> (Opsional) untuk efek tambahan.</li>
            <li><span class="tutorial-step">3. Battle Phase:</span> Jawab soal matematika dengan benar!
                <br>- <strong>Benar:</strong> Serangan masuk ke HP lawan.
                <br>- <strong>Salah:</strong> Serangan berbalik mengenai Anda.
            </li>
            <li><span class="tutorial-step">4. End Phase:</span> Akhiri giliran dan biarkan AI menyerang.</li>
            <li><span class="tutorial-step">Kemenangan:</span> Buat HP Lawan menjadi 0.</li>
        </ul>
      </div>
      <div class="modal-buttons">
        <button class="modal-btn cancel" id="closeTutorialBtn">Tutup & Main</button>
      </div>
    </div>
  </div>

  <script>
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzSQqJcpcsU93MuP7qJ8BDl0oU7CPYgW__TJAfkAgQmdOFlOHYr8O_pJhD4ngjAQq96/exec'; 

    const defaultConfig = {
      game_title: "Transformation Card Game",
      player_name: "Player",
      ai_name: "Captain Blackbeard"
    };

    // --- DECK DATA BARU SESUAI PDF ---
    const deckData = [
      // Kartu Soal
      { id: 1, name: "Vertical Shift", type: "question", question: "Translasi vertikal f(x) = x^2 naik 3 satuan.", answers: ["f(x)=x^2+3", "f(x)=3+x^2"], atk: 600 },
      { id: 2, name: "Horizontal Drift", type: "question", question: "Translasi horizontal f(x) = x^2 ke kanan 2 satuan.", answers: ["f(x)=(x-2)^2", "f(x)=x^2-4x+4"], atk: 650 },
      { id: 3, name: "Double Translation", type: "question", question: "f(x) = 2x + 1 ditranslasi oleh T(1,-2).", answers: ["f(x)=2x-3", "f(x)=2(x-1)-1"], atk: 800 },
      { id: 4, name: "Mirror X-Axis", type: "question", question: "Refleksi f(x) = x^2 - 4 terhadap sumbu-x.", answers: ["f(x)=-x^2+4"], atk: 700 },
      { id: 5, name: "Mirror Y-Axis", type: "question", question: "Refleksi f(x) = 2x + 3 terhadap sumbu-y.", answers: ["f(x)=-2x+3", "f(x)=3-2x"], atk: 650 },
      { id: 6, name: "Linear Reflection", type: "question", question: "Refleksi f(x) = x - 5 terhadap garis y = x.", answers: ["f(x)=x+5"], atk: 850 },
      { id: 7, name: "Parabola Transform", type: "question", question: "Sebuah parabola memiliki puncak di (2,5). Jika parabola tersebut adalah hasil translasi dari f(x) = x^2, maka persamaannya adalah...", answers: ["f(x)=(x-2)^2+5", "f(x)=x^2-4x+9"], atk: 800 },
      { id: 8, name: "Combined Transform", type: "question", question: "Garis f(x) = 2x digeser oleh translasi T(a,b) sehingga menjadi f(x) = 2(x - 3) + 4. Nilai a dan b berturut-turut adalah", answers: ["3 dan 4", "3dan4", "T(3,4)"], atk: 750 },
      { id: 9, name: "Exponential Shift", type: "question", question: "f(x) = 2^x ditranslasi ke atas 1 satuan.", answers: ["f(x)=2^x+1"], atk: 850 },
      { id: 10, name: "Quadratic Move", type: "question", question: "f(x) = x^2 - 2x ditranslasi T(-1,3).", answers: ["f(x)=x^2+4"], atk: 750 },
      { id: 11, name: "Absolute Mirror", type: "question", question: "Refleksi f(x) = |x| terhadap sumbu-x.", answers: ["f(x)=-|x|"], atk: 900 },
      { id: 12, name: "Parabola Flip", type: "question", question: "Refleksi f(x) = (x - 1)^2 terhadap sumbu-y.", answers: ["f(x)=(x+1)^2", "f(x)=(-x-1)^2", "f(x)=x^2+2x+1"], atk: 700 },
      { id: 13, name: "Combined Transform", type: "question", question: "f(x) = x^2 direfleksi sumbu-x lalu translasi T(0,2).", answers: ["f(x)=-x^2+2", "f(x)=2-x^2"], atk: 1000 },
      { id: 14, name: "Mirror Y-Axis", type: "question", question: "Diketahui fungsi f(x) = 3x - 4 menjadi f(x) = 3x - 1 setelah ditranslasi vertikal. Berapa besar pergeserannya?", answers: ["3", "T(0,3)"], atk: 1000 },
      { id: 15, name: "Double Reflection", type: "question", question: "f(x) = x + 2 direfleksi sumbu-x lalu sumbu-y.", answers: ["f(x)=x-2"], atk: 750 },
      { id: 16, name: "Trigonometric Shift", type: "question", question: "f(x) = sin(x) ditranslasi T(œÄ/2,0).", answers: ["f(x)=sin(x-œÄ/2)", "f(x)=sin(x-(œÄ/2))", "f(x)=sin(x-pi/2)", "f(x)=sin(x-(pi/2))"], atk: 950 },
      { id: 17, name: "Rational Transform", type: "question", question: "f(x) = 1/x ditranslasi T(2,1).", answers: ["f(x)=1/(x-2)+1", "f(x)=(1/(x-2))+1"], atk: 1000 },
      { id: 18, name: "Cubic Reflection", type: "question", question: "f(x) = x^3 direfleksi terhadap sumbu-y.", answers: ["f(x)=-x^3"], atk: 1000 },
      { id: 19, name: "Logarithm Shift", type: "question", question: "f(x) = log(x) ditranslasi naik 2 satuan.", answers: ["f(x)=log(x)+2"], atk: 900 },
      { id: 20, name: "Complex Transform", type: "question", question: "f(x) = x^2 + 1 direfleksi sumbu-x, translasi T(1,0).", answers: ["f(x)=-(x-1)^2-1", "f(x)=-x^2+2x-2"], atk: 950 },
      { id: 21, name: "Function Transform", type: "question", question: "Jika y = f(x) digeser menjadi y = f(x + a) + b. Jika pergeserannya adalah ke kiri 2 satuan dan ke bawah 5 satuan, tuliskan bentuk fungsinya!", answers: ["y=f(x+2)-5"], atk: 800 },
      { id: 22, name: "Moved Function", type: "question", question: "Grafik f(x) = x^2 digeser sehingga titik (0,0) pindah ke (3,1). Tentukan persamaan fungsi kuadrat yang baru!", answers: ["f(x)=(x-3)^2+1", "f(x)=x^2-6x+10"], atk: 650 },
      { id: 23, name: "Line Shift", type: "question", question: "Sebuah garis y = x digeser ke atas sejauh 3 satuan. Tentukan titik potong fungsi baru tersebut terhadap sumbu-y!", answers: ["(0,3)"], atk: 750 },
      { id: 24, name: "Interception Reflection", type: "question", question: "Grafik fungsi f(x) = 5 - x^2 memotong sumbu-y di titik (0,5). Jika grafik direfleksikan terhadap sumbu-x, titik potong sumbu-y yang baru adalah", answers: ["(0,-5)"], atk: 850 },
      { id: 25, name: "Absolute Shift", type: "question", question: "Fungsi f(x) = |x - 2| direfleksikan terhadap sumbu-y. Persamaan bayangannya adalah...", answers: ["f(x)=|-x-2|", "f(x)=|x+2|"], atk: 750 },
      { id: 26, name: "Quadratic Reflection", type: "question", question: "Grafik f(x) = x^2 - 6x direfleksikan terhadap sumbu-y. Persamaan barunya adalah..", answers: ["f(x)=x^2+6x"], atk: 800 },
      { id: 27, name: "Shadow Function", type: "question", question: "Tentukan persamaan bayangan f(x) = x^2 - 4x + 3 yang direfleksikan terhadap sumbu-x", answers: ["f(x)=-x^2+4x-3"], atk: 1000 },
      { id: 28, name: "Line Reflection", type: "question", question: "Sebuah garis melalui (2,3). Jika garis tersebut direfleksikan terhadap sumbu-x, maka garis bayangan akan melalui titik..", answers: ["(2,-3)"], atk: 900 },
      { id: 29, name: "Line Reflection", type: "question", question: "Sebuah garis melalui (2,3). Jika garis tersebut direfleksikan terhadap sumbu-y, maka garis bayangan akan melalui titik", answers: ["(-2,3)"], atk: 900 },
      { id: 30, name: "Double Transform", type: "question", question: "Fungsi f(x) = x^2 digeser ke kanan sejauh 2 satuan, kemudian direfleksikan terhadap sumbu-x. persamaan akhirnya adalah...", answers: ["f(x)=-(x-2)^2", "f(x)=-x^2+4x-4"], atk: 750 },
      { id: 31, name: "Point Transform", type: "question", question: "Sebuah titik P(2,5) terletak pada grafik fungsi f(x). Jika f(x) ditranslasikan oleh T(-1,3) kemudian direfleksikan terhadap sumbu-x, koordinat bayangan titik P adalah..", answers: ["(1,-8)"], atk: 900 },
      { id: 32, name: "Function Transform", type: "question", question: "Fungsi f(x) = 2^x digeser ke atas 1 satuan, kemudian direfleksikan terhadap sumbu-y. persamaannya menjadi..", answers: ["f(x)=2^-x+1", "f(x)=2^(-x)+1", "f(x)=(2^(-x))+1", "f(x)=(1/2)^x+1"], atk: 750 },
      { id: 33, name: "Moved Quadratic", type: "question", question: "Fungsi kuadrat dengan puncak di (0,0) digeser sehingga puncaknya menjadi (3,-2), lalu kurva tersebut dibalik (terbuka ke bawah). Persamaannya adalah...", answers: ["f(x)=-(x-3)^2-2", "y=-(x-3)^2-2", "f(x)=-x^2+6x-11", "y=-x^2+6x-11"], atk: 900 },
      { id: 34, name: "Parabola Transform", type: "question", question: "Sebuah parabola f(x) = x^2 - 4x + 3 memiliki titik puncak P. Jika parabola direfleksikan terhadap sumbu-x, koordinat puncak yang baru adalah", answers: ["(2,1)", "(2, 1)"], atk: 800 },
      { id: 35, name: "Double Translation", type: "question", question: "Jika f(x) = 2x - 4 digeser ke kiri 2 satuan, lalu direfleksikan terhadap sumbu-y, hasil akhirnya adalah...", answers: ["f(x)=-2x"], atk: 650 },
      
      // Kartu Spell

      { id: 36, name: "Rum Power", type: "spell", effect: "+300 ATK", bonus: 300 },
      { id: 37, name: "Swift Sails", type: "spell", effect: "+200 ATK", bonus: 200 },
      { id: 38, name: "Cannon Barrage", type: "spell", effect: "+500 ATK", bonus: 500 },
      { id: 39, name: "Kraken's Fury", type: "spell", effect: "+700 ATK", bonus: 700 },
      { id: 40, name: "Captain's Wisdom", type: "spell", effect: "+400 ATK", bonus: 400 },
      { id: 41, name: "Treasure Double", type: "spell", effect: "Gandakan ATK x2", bonus: "double" },
      { id: 42, name: "Gold Coin Boost", type: "spell", effect: "+600 ATK", bonus: 600 },
      { id: 43, name: "Sea Breeze Heal", type: "spell", effect: "Heal +300", bonus: "heal300" },
      { id: 44, name: "Ship's Hull", type: "spell", effect: "Kurangi damage -400", bonus: "shield400" },
      { id: 45, name: "Storm Surge", type: "spell", effect: "+400 ATK", bonus: 400 },
      { id: 46, name: "Ha'as Claw", type: "spell", effect: "Berikan 600 Dmg ke lawan, dan pulihkan 300 HP", bonus: "haas_claw" },
      { id: 47, name: "Jack of Trade", type: "spell", effect: "Kembalikan semua kartu ke Deck, shuffle, lalu ambil kartu dengan jumlah yang dikembalikan", bonus: "jack_trade" },
      { id: 48, name: "Premature Burial", type: "spell", effect: "Buang satu kartu dari tangan ke Graveyard", bonus: "premature_burial" },
      { id: 49, name: "Living Dead", type: "spell", effect: "Ambil satu kartu dari Graveyard untuk ditambahkan ke tangan", bonus: "living_dead" },
      { id: 50, name: "Athena Shield", type: "spell", effect: "Kebal terhadap damage ketika jawaban salah", bonus: "athena_shield" }
    ];

    let gameState = {
      deck: [...deckData],
      hand: [],
      graveyard: [],
      aiDeck: [...deckData],
      aiHand: [],
      playerHP: 10000,
      aiHP: 10000,
      currentPhase: "start",
      currentTurn: "player",
      questionCard: null,
      spellCard: null,
      aiQuestionCard: null,
      aiSpellCard: null,
      playerAnswer: "",
      gameStarted: false,
      cardsHidden: false,
      logHidden: false,
      isAIThinking: false,
      hasDrawnThisTurn: false,
      playerTotalScore: 0 
    };

    function shuffleDeck() {
      for (let i = gameState.deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [gameState.deck[i], gameState.deck[j]] = [gameState.deck[j], gameState.deck[i]];
      }
      gameState.aiDeck = [...deckData];
      for (let i = gameState.aiDeck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [gameState.aiDeck[i], gameState.aiDeck[j]] = [gameState.aiDeck[j], gameState.aiDeck[i]];
      }
    }

    function drawCard() {
      if (gameState.deck.length > 0) {
        const card = gameState.deck.pop();
        gameState.hand.push(card);
        updateUI();
        addLog(`Player menarik kartu: ${card.name}`);
      }
    }

    function aiDrawCard() {
      if (gameState.aiDeck.length > 0) {
        const card = gameState.aiDeck.pop();
        gameState.aiHand.push(card);
        addLog(`AI menarik kartu dari deck`);
      }
    }

    function renderCard(card) {
      const cardEl = document.createElement('div');
      cardEl.className = card.type === 'spell' ? 'card spell-card' : 'card';
      cardEl.dataset.cardId = card.id;
      
      if (card.type === 'question') {
        cardEl.innerHTML = `
          <div class="card-title">${card.name}</div>
          <div class="card-type">üó∫Ô∏è SOAL TRANSFORMASI</div>
          <div class="card-content">${card.question}</div>
          <div class="card-atk">ATK: ${card.atk}</div>
        `;
      } else {
        cardEl.innerHTML = `
          <div class="card-title">${card.name}</div>
          <div class="card-type">‚öîÔ∏è SPELL CARD</div>
          <div class="card-content">${card.effect}</div>
        `;
      }
      
      cardEl.addEventListener('click', () => selectCard(card));
      return cardEl;
    }

    function selectCard(card) {
      if (gameState.currentPhase !== 'set' || gameState.currentTurn !== 'player' || gameState.isAIThinking) return;
      
      const cardEls = document.querySelectorAll('.card');
      cardEls.forEach(el => el.classList.remove('selected'));
      
      const selectedEl = document.querySelector(`[data-card-id="${card.id}"]`);
      if (selectedEl) selectedEl.classList.add('selected');
      
      if (card.type === 'question' && !gameState.questionCard) {
        gameState.questionCard = card;
        gameState.hand = gameState.hand.filter(c => c.id !== card.id);
        updateUI();
        addLog(`Kartu soal diletakkan: ${card.name}`);
      } else if (card.type === 'spell' && !gameState.spellCard && gameState.questionCard) {
        gameState.spellCard = card;
        gameState.hand = gameState.hand.filter(c => c.id !== card.id);
        updateUI();
        addLog(`Kartu spell diaktifkan: ${card.name}`);
      }
    }

    function updateTurnIndicator() {
      const indicator = document.getElementById('turnIndicator');
      if (!gameState.gameStarted) {
        indicator.textContent = 'Tekan Start Game';
        indicator.className = 'turn-indicator';
      } else if (gameState.currentTurn === 'player') {
        indicator.textContent = 'üéÆ Giliran Player';
        indicator.className = 'turn-indicator';
      } else {
        indicator.textContent = ' Giliran AI';
        indicator.className = 'turn-indicator ai-turn';
      }
    }

    function showDamage(target, amount) {
      const container = target === 'player' 
        ? document.getElementById('playerHP').parentElement 
        : document.getElementById('aiHP').parentElement;
      
      const damageEl = document.createElement('div');
      damageEl.className = 'damage-number';
      damageEl.textContent = `-${amount}`;
      damageEl.style.left = '50%';
      damageEl.style.top = '50%';
      damageEl.style.transform = 'translate(-50%, -50%)';
      
      container.appendChild(damageEl);
      container.classList.add('damage');
      const hpValue = target === 'player' 
        ? document.getElementById('playerHP')
        : document.getElementById('aiHP');
      hpValue.classList.add('hit');
      
      setTimeout(() => { damageEl.remove(); }, 1500);
      setTimeout(() => { container.classList.remove('damage'); hpValue.classList.remove('hit'); }, 500);
    }
    
    function showHeal(target, amount) {
      const container = target === 'player' 
        ? document.getElementById('playerHP').parentElement 
        : document.getElementById('aiHP').parentElement;
      
      const healEl = document.createElement('div');
      healEl.className = 'heal-number';
      healEl.textContent = `+${amount}`;
      healEl.style.left = '50%';
      healEl.style.top = '50%';
      healEl.style.transform = 'translate(-50%, -50%)';
      
      container.appendChild(healEl);
      setTimeout(() => { healEl.remove(); }, 1500);
    }

    function updateUI() {
      document.getElementById('deckCount').textContent = gameState.deck.length;
      document.getElementById('playerHP').textContent = gameState.playerHP;
      document.getElementById('aiHP').textContent = gameState.aiHP;
      document.getElementById('currentScore').textContent = gameState.playerTotalScore;
      
      // --- LOGIKA UBAH TAMPILAN (UPDATE CROWN MODE) ---
      // Hapus semua class mode terlebih dahulu
      document.body.classList.remove('warning-mode', 'critical-mode', 'golden-mode', 'crown-mode'); 

      // 1. Cek Kritis Dulu (Prioritas Utama - Nyawa Sekarat)
      if (gameState.playerHP <= 2500) {
          document.body.classList.add('critical-mode');
      } 
      // 2. Cek Crown Mode (Prioritas Kedua - Skor >= 6000)
      else if (gameState.playerTotalScore >= 6000) {
          document.body.classList.add('crown-mode');
      }
      // 3. Cek Golden Mode (Skor >= 4000)
      else if (gameState.playerTotalScore >= 4000) {
          document.body.classList.add('golden-mode');
      } 
      // 4. Cek Warning Mode (HP <= 5000)
      else if (gameState.playerHP <= 5000) {
          document.body.classList.add('warning-mode');
      }
      
      updateTurnIndicator();
      
      const handContainer = document.getElementById('handCards');
      handContainer.innerHTML = '';
      gameState.hand.forEach(card => {
        handContainer.appendChild(renderCard(card));
      });
      
      const questionSlot = document.getElementById('questionSlot');
      questionSlot.innerHTML = '<span class="card-slot-label">Kartu Soal</span>';
      
      if (gameState.currentTurn === 'player' && gameState.questionCard) {
        const cardEl = renderCard(gameState.questionCard);
        cardEl.style.cursor = 'default';
        cardEl.onclick = null;
        questionSlot.appendChild(cardEl);
      }
      
      if (gameState.currentTurn === 'ai' && gameState.aiQuestionCard) {
        const cardEl = renderCard(gameState.aiQuestionCard);
        cardEl.style.cursor = 'default';
        cardEl.onclick = null;
        questionSlot.appendChild(cardEl);
      }
      
      const spellSlot = document.getElementById('spellSlot');
      spellSlot.innerHTML = '<span class="card-slot-label">Kartu Spell</span>';
      
      if (gameState.currentTurn === 'player' && gameState.spellCard) {
        const cardEl = renderCard(gameState.spellCard);
        cardEl.style.cursor = 'default';
        cardEl.onclick = null;
        spellSlot.appendChild(cardEl);
      }
      
      if (gameState.currentTurn === 'ai' && gameState.aiSpellCard) {
        const cardEl = renderCard(gameState.aiSpellCard);
        cardEl.style.cursor = 'default';
        cardEl.onclick = null;
        spellSlot.appendChild(cardEl);
      }
      
      const graveyardContainer = document.getElementById('graveyardCards');
      graveyardContainer.innerHTML = '';
      gameState.graveyard.forEach(card => {
        const miniCard = document.createElement('div');
        miniCard.className = 'graveyard-card-mini';
        miniCard.textContent = card.name;
        graveyardContainer.appendChild(miniCard);
      });

      // --- LOGIKA BARU: TOMBOL TUKAR KARTU ---
      // Cek apakah hand hanya berisi Spell (dan ada kartu)
      const hasQuestionCard = gameState.hand.some(card => card.type === 'question');
      const swapBtn = document.getElementById('swapHandBtn');

      if (gameState.currentTurn === 'player' && 
          gameState.currentPhase === 'set' && 
          gameState.hand.length > 0 && 
          !hasQuestionCard) {
          swapBtn.style.display = 'block';
      } else {
          swapBtn.style.display = 'none';
      }
    }

    function addLog(message, type = 'normal') {
      const logContainer = document.getElementById('gameLog');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `‚Ä¢ ${message}`;
      logContainer.appendChild(entry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    function startGame() {
      if (gameState.gameStarted) return;
      shuffleDeck();
      for (let i = 0; i < 5; i++) {
        drawCard();
        aiDrawCard();
      }
      gameState.gameStarted = true;
      gameState.currentTurn = 'player';
      gameState.currentPhase = 'set';
      gameState.hasDrawnThisTurn = false;
      gameState.playerTotalScore = 0;
      
      document.getElementById('startBtn').disabled = true;
      document.getElementById('setPhaseBtn').disabled = false;
      document.getElementById('setPhaseBtn').classList.add('active');
      
      updateUI();
      addLog('Game dimulai! Player dan AI menarik 5 kartu.', 'success');
      addLog('Giliran Player - Fase SET PHASE. Letakkan kartu soal dan spell (opsional).');
    }

    async function aiTurn() {
      if (gameState.isAIThinking) return;
      gameState.isAIThinking = true;
      gameState.currentTurn = 'ai';
      gameState.hasDrawnThisTurn = false;
      updateUI();
      
      disablePlayerControls();
      
      addLog('--- Giliran AI Dimulai ---', 'success');
      await sleep(1500);
      
      addLog('AI - Draw Phase');
      if (gameState.aiDeck.length > 0) {
        aiDrawCard();
        gameState.hasDrawnThisTurn = true;
        updateUI();
        await sleep(1000);
      }
      
      addLog('AI memasuki Set Phase...');
      await sleep(1000);
      
      const questionCards = gameState.aiHand.filter(c => c.type === 'question');
      const spellCards = gameState.aiHand.filter(c => c.type === 'spell');
      
      if (questionCards.length > 0) {
        const randomQuestion = questionCards[Math.floor(Math.random() * questionCards.length)];
        gameState.aiQuestionCard = randomQuestion;
        gameState.aiHand = gameState.aiHand.filter(c => c.id !== randomQuestion.id);
        addLog(`AI menaruh kartu soal: ${randomQuestion.name} (ATK: ${randomQuestion.atk})`);
        updateUI();
        await sleep(1500);
        
        if (spellCards.length > 0 && Math.random() > 0.3) {
          const randomSpell = spellCards[Math.floor(Math.random() * spellCards.length)];
          gameState.aiSpellCard = randomSpell;
          gameState.aiHand = gameState.aiHand.filter(c => c.id !== randomSpell.id);
          addLog(`AI mengaktifkan spell: ${randomSpell.name}`);
          updateUI();
          await sleep(1500);
        }
      }
      
      if (gameState.aiQuestionCard) {
        addLog('AI memasuki Battle Phase...', 'success');
        await sleep(1500);
        
        const isAICorrect = Math.random() > 0.3;
        let baseAtk = gameState.aiQuestionCard.atk;
        let totalDamage = baseAtk;
        
        if (gameState.aiSpellCard) {
          const spell = gameState.aiSpellCard;
          if (spell.bonus === 'double') {
            totalDamage = baseAtk * 2;
            addLog(`${spell.name} menggandakan ATK AI menjadi ${totalDamage}!`);
          } else if (spell.bonus === 'heal300') {
            gameState.aiHP = Math.min(10000, gameState.aiHP + 300);
            showHeal('ai', 300);
            addLog(`${spell.name} memulihkan 300 HP AI!`, 'success');
          } else if (spell.bonus === 'shield400') {
            addLog(`${spell.name} mengurangi damage masuk AI -400!`);
          } else if (typeof spell.bonus === 'number') {
            totalDamage = baseAtk + spell.bonus;
            addLog(`${spell.name} menambahkan +${spell.bonus} ATK AI!`);
          }
          await sleep(1000);
        }
        
        if (isAICorrect) {
          gameState.playerHP = Math.max(0, gameState.playerHP - totalDamage);
          showDamage('player', totalDamage);
          addLog(`‚úÖ AI menjawab BENAR! Player menerima ${totalDamage} damage!`, 'damage');
        } else {
          let damageToAI = totalDamage;
          if (gameState.aiSpellCard && gameState.aiSpellCard.bonus === 'shield400') {
            damageToAI = Math.max(0, damageToAI - 400);
          }
          gameState.aiHP = Math.max(0, gameState.aiHP - damageToAI);
          showDamage('ai', damageToAI);
          addLog(`‚ùå AI menjawab SALAH! AI menerima ${damageToAI} damage!`, 'success');
        }
        
        await sleep(2000);
        gameState.graveyard.push(gameState.aiQuestionCard);
        if (gameState.aiSpellCard) gameState.graveyard.push(gameState.aiSpellCard);
        gameState.aiQuestionCard = null;
        gameState.aiSpellCard = null;
        updateUI();
        
        if (checkGameOver()) {
          gameState.isAIThinking = false;
          return;
        }
      }
      
      addLog('AI mengakhiri turn...');
      await sleep(1500);
      
      gameState.currentTurn = 'player';
      gameState.currentPhase = 'set';
      gameState.isAIThinking = false;
      gameState.hasDrawnThisTurn = false;
      
      addLog('--- Giliran Player Dimulai ---', 'success');
      addLog('Player - Draw Phase');
      if (gameState.deck.length > 0) {
        drawCard();
        gameState.hasDrawnThisTurn = true;
      }
      
      enablePlayerControls();
      updateUI();
      addLog('Fase SET PHASE. Letakkan kartu Anda.');
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function disablePlayerControls() {
      document.getElementById('setPhaseBtn').disabled = true;
      document.getElementById('battlePhaseBtn').disabled = true;
      document.getElementById('endPhaseBtn').disabled = true;
      document.getElementById('deckStack').style.pointerEvents = 'none';
      document.getElementById('deckStack').style.opacity = '0.5';
    }

    function enablePlayerControls() {
      document.getElementById('setPhaseBtn').disabled = false;
      document.getElementById('setPhaseBtn').classList.add('active');
      document.getElementById('deckStack').style.pointerEvents = 'auto';
      document.getElementById('deckStack').style.opacity = '1';
    }

    function checkGameOver() {
      let isOver = false;
      let modalTitle = "";
      let modalText = "";

      if (gameState.playerHP <= 0) {
        addLog('üî• GAME OVER! Player kalah!', 'damage');
        modalTitle = "üî• Game Over";
        modalText = "AI memenangkan pertempuran! Namun, simpan skormu ke Leaderboard!";
        isOver = true;
      }
      
      if (gameState.aiHP <= 0) {
        addLog('üèÜ KEMENANGAN! Player menang!', 'success');
        modalTitle = "üèÜ Kemenangan!";
        modalText = `Selamat! Anda mengalahkan AI! Skor Akhir: ${gameState.playerTotalScore}`;
        isOver = true;
      }

      if (isOver) {
        setTimeout(() => {
          const overlay = document.createElement('div');
          overlay.className = 'modal active';
          overlay.innerHTML = `
            <div class="modal-content">
              <div class="modal-title">${modalTitle}</div>
              <div class="modal-text">${modalText}</div>
              <input type="text" id="playerNameInput" class="answer-input" placeholder="Masukkan Nama Anda untuk Leaderboard" value="${defaultConfig.player_name}">
              <div class="modal-buttons">
                <button class="modal-btn" onclick="submitScore()">Simpan Skor & Main Lagi</button>
                <button class="modal-btn cancel" onclick="location.reload()">Hanya Main Lagi</button>
              </div>
            </div>
          `;
          document.body.appendChild(overlay);
        }, 1000);
        return true;
      }
      return false;
    }

    function setPhase() {
      if (!gameState.questionCard) {
        addLog('Letakkan minimal 1 kartu soal!', 'damage');
        return;
      }
      document.getElementById('answerModalTitle').textContent = gameState.questionCard.name;
      document.getElementById('answerModalQuestion').textContent = gameState.questionCard.question;
      document.getElementById('answerInput').value = '';
      document.getElementById('answerModal').classList.add('active');
    }

    function battlePhase() {
      document.getElementById('battleModal').classList.add('active');
    }

    function processBattle() {
      const questionCard = gameState.questionCard;
      const spellCard = gameState.spellCard;
      const userAnswer = gameState.playerAnswer.trim().toLowerCase().replace(/\s/g, '');
      const isCorrect = questionCard.answers.some(ans => ans.toLowerCase().replace(/\s/g, '') === userAnswer
      );
      
      let baseAtk = questionCard.atk;
      let totalDamage = baseAtk;
      
      // LOGIKA KARTU SPELL BARU (4 KARTU)
      if (spellCard) {
        if (spellCard.bonus === 'double') {
          totalDamage = baseAtk * 2;
          addLog(`${spellCard.name} menggandakan ATK menjadi ${totalDamage}!`);
        } else if (spellCard.bonus === 'heal300') {
          gameState.playerHP = Math.min(10000, gameState.playerHP + 300);
          showHeal('player', 300);
          addLog(`${spellCard.name} memulihkan 300 HP!`, 'success');
        } else if (spellCard.bonus === 'shield400') {
          addLog(`${spellCard.name} mengurangi damage yang masuk -400!`);
        } else if (typeof spellCard.bonus === 'number') {
          totalDamage = baseAtk + spellCard.bonus;
          addLog(`${spellCard.name} menambahkan +${spellCard.bonus} ATK!`);
        } 
        
        // --- 4 KARTU POWER UP BARU ---
        else if (spellCard.bonus === 'haas_claw') {
            totalDamage += 600;
            gameState.playerHP = Math.min(10000, gameState.playerHP + 300);
            showHeal('player', 300);
            addLog(`${spellCard.name}: +600 Dmg & +300 HP!`, 'success');
        }
        else if (spellCard.bonus === 'jack_trade') {
            const handSize = gameState.hand.length;
            if (handSize > 0) {
                // Return hand to deck
                gameState.deck = gameState.deck.concat(gameState.hand);
                gameState.hand = [];
                // Simple shuffle for array
                for (let i = gameState.deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [gameState.deck[i], gameState.deck[j]] = [gameState.deck[j], gameState.deck[i]];
                }
                // Draw back same amount
                for(let i=0; i<handSize; i++) {
                    if (gameState.deck.length > 0) gameState.hand.push(gameState.deck.pop());
                }
                addLog(`${spellCard.name}: Hand di-shuffle & redraw!`);
            }
        }
        else if (spellCard.bonus === 'premature_burial') {
            if (gameState.hand.length > 0) {
                // Prompt user to discard
                let msg = "Pilih kartu di tangan untuk dibuang (ketik nomor):\n";
                gameState.hand.forEach((c, i) => msg += `${i+1}. ${c.name}\n`);
                let choice = prompt(msg);
                let idx = parseInt(choice) - 1;
                if (gameState.hand[idx]) {
                    const discarded = gameState.hand.splice(idx, 1)[0];
                    gameState.graveyard.push(discarded);
                    addLog(`${spellCard.name}: Membuang ${discarded.name} ke Graveyard.`);
                }
            }
        }
        else if (spellCard.bonus === 'living_dead') {
            if (gameState.graveyard.length > 0) {
                // Prompt user to revive
                let msg = "Pilih kartu dari Graveyard (ketik nomor):\n";
                gameState.graveyard.forEach((c, i) => msg += `${i+1}. ${c.name}\n`);
                let choice = prompt(msg);
                let idx = parseInt(choice) - 1;
                if (gameState.graveyard[idx]) {
                    const revived = gameState.graveyard.splice(idx, 1)[0];
                    gameState.hand.push(revived);
                    addLog(`${spellCard.name}: Mengambil ${revived.name} dari Graveyard!`);
                }
            } else {
                addLog(`${spellCard.name} gagal: Graveyard kosong.`);
            }
        }
      }
      
      if (isCorrect) {
        gameState.aiHP = Math.max(0, gameState.aiHP - totalDamage);
        showDamage('ai', totalDamage);
        
        // --- MODIFIKASI: MENGGUNAKAN totalDamage ---
        gameState.playerTotalScore += totalDamage; 
        addLog(`‚úÖ JAWABAN BENAR! +${totalDamage} Poin Skor! AI menerima ${totalDamage} damage!`, 'success');
        
      } else {
        let damageToPlayer = totalDamage;
        if (spellCard && spellCard.bonus === 'shield400') {
          damageToPlayer = Math.max(0, damageToPlayer - 400);
        }

        // --- ATHENA SHIELD LOGIC ---
        if (spellCard && spellCard.bonus === 'athena_shield') {
            damageToPlayer = 0;
            addLog(`üõ°Ô∏è Athena Shield melindungi Anda! Tidak ada damage yang diterima!`, 'success');
        }
        // ---------------------------

        gameState.playerHP = Math.max(0, gameState.playerHP - damageToPlayer);
        if (damageToPlayer > 0) {
            showDamage('player', damageToPlayer);
            addLog(`‚ùå JAWABAN SALAH! Player menerima ${damageToPlayer} damage!`, 'damage');
        }
        const formattedAnswers = questionCard.answers.join('; ');
        addLog('Jawaban benar: ${formattedAnswers}', 'damage');
      }
      
      gameState.graveyard.push(questionCard);
      if (spellCard) gameState.graveyard.push(spellCard);
      
      gameState.questionCard = null;
      gameState.spellCard = null;
      gameState.playerAnswer = "";
      updateUI();
      
      if (checkGameOver()) return;
    }

    function endPhase() {
      document.getElementById('setPhaseBtn').disabled = true;
      document.getElementById('battlePhaseBtn').disabled = true;
      document.getElementById('endPhaseBtn').disabled = true;
      document.getElementById('setPhaseBtn').classList.remove('active');
      document.getElementById('battlePhaseBtn').classList.remove('active');
      document.getElementById('endPhaseBtn').classList.remove('active');
      addLog('Player mengakhiri turn.');
      setTimeout(() => { aiTurn(); }, 1000);
    }
    
    // --- FUNGSI BARU: SWAP HAND (MULLIGAN) ---
    function swapHand() {
        if (gameState.hand.length === 0) return;

        addLog("üîÑ Mengembalikan kartu ke Deck dan mengocok ulang...", "warning");

        // Kembalikan tangan ke deck
        gameState.deck = gameState.deck.concat(gameState.hand);
        gameState.hand = [];

        // Kocok ulang
        shuffleDeck();

        // Tarik 5 kartu baru
        for (let i = 0; i < 5; i++) {
            if (gameState.deck.length > 0) {
                const card = gameState.deck.pop();
                gameState.hand.push(card);
            }
        }

        updateUI();
    }

    // Event Listener untuk tombol swap
    document.getElementById('swapHandBtn').addEventListener('click', swapHand);

    function submitScore() {
        const name = document.getElementById('playerNameInput').value || "Anonymous Pirate";
        const score = gameState.playerTotalScore;
        
        if(GOOGLE_SCRIPT_URL.includes('MASUKKAN_URL')) {
            alert("Error: URL Database belum disetting di kode program.");
            return;
        }

        const formData = new FormData();
        formData.append('nama', name);
        formData.append('skor', score);

        fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            alert("Skor berhasil disimpan ke Leaderboard!");
            location.reload();
        })
        .catch(error => {
            console.error('Error:', error);
            alert("Gagal menyimpan skor. Cek koneksi internet.");
            location.reload();
        });
    }

    document.getElementById('openLeaderboard').addEventListener('click', () => {
        const modal = document.getElementById('leaderboardModal');
        const listDiv = document.getElementById('leaderboardList');
        modal.classList.add('active');
        listDiv.innerHTML = "Mengambil data dari lautan...";
        
        if(GOOGLE_SCRIPT_URL.includes('MASUKKAN_URL')) {
            listDiv.innerHTML = "‚ö†Ô∏è URL Database belum diatur. Hubungi Developer.";
            return;
        }

        fetch(GOOGLE_SCRIPT_URL + '?action=get')
        .then(response => response.json())
        .then(data => {
            let html = '<table class="leaderboard-table"><thead><tr><th>Rank</th><th>Nama</th><th>Skor</th></tr></thead><tbody>';
            data.forEach((row, index) => {
                let medal = '';
                if(index === 0) medal = 'ü•á ';
                if(index === 1) medal = 'ü•à ';
                if(index === 2) medal = 'ü•â ';
                html += `<tr><td>${medal}${index + 1}</td><td>${row.nama}</td><td>${row.skor}</td></tr>`;
            });
            html += '</tbody></table>';
            listDiv.innerHTML = html;
        })
        .catch(error => {
            listDiv.innerHTML = "Gagal memuat leaderboard.";
            console.error(error);
        });
    });

    document.getElementById('deckStack').addEventListener('click', () => {
      if (gameState.gameStarted && gameState.deck.length > 0 && gameState.currentTurn === 'player' && !gameState.isAIThinking) {
        if (gameState.hasDrawnThisTurn) {
          addLog('Anda sudah menarik kartu di turn ini!', 'damage');
        } else {
          drawCard();
          gameState.hasDrawnThisTurn = true;
        }
      }
    });

    document.getElementById('startBtn').addEventListener('click', startGame);
    document.getElementById('setPhaseBtn').addEventListener('click', setPhase);
    document.getElementById('battlePhaseBtn').addEventListener('click', battlePhase);
    document.getElementById('endPhaseBtn').addEventListener('click', endPhase);

    document.getElementById('hideToggle').addEventListener('click', () => {
      gameState.cardsHidden = !gameState.cardsHidden;
      const handCards = document.getElementById('handCards');
      const toggleBtn = document.getElementById('hideToggle');
      if (gameState.cardsHidden) {
        handCards.classList.add('hidden');
        toggleBtn.textContent = 'Show Cards';
      } else {
        handCards.classList.remove('hidden');
        toggleBtn.textContent = 'Hide Cards';
      }
    });

    document.getElementById('logToggle').addEventListener('click', () => {
      gameState.logHidden = !gameState.logHidden;
      const gameLog = document.getElementById('gameLog');
      const toggleBtn = document.getElementById('logToggle');
      if (gameState.logHidden) {
        gameLog.classList.add('hidden');
        toggleBtn.textContent = 'Show Log';
      } else {
        gameLog.classList.remove('hidden');
        toggleBtn.textContent = 'Hide Log';
      }
    });

    document.getElementById('confirmBattle').addEventListener('click', () => {
      document.getElementById('battleModal').classList.remove('active');
      processBattle();
    });
    document.getElementById('cancelBattle').addEventListener('click', () => {
      document.getElementById('battleModal').classList.remove('active');
    });

    document.getElementById('submitAnswer').addEventListener('click', () => {
      const answer = document.getElementById('answerInput').value;
      if (!answer.trim()) {
        addLog('Masukkan jawaban terlebih dahulu!', 'damage');
        return;
      }
      gameState.playerAnswer = answer;
      document.getElementById('answerModal').classList.remove('active');
      gameState.currentPhase = 'battle';
      document.getElementById('setPhaseBtn').disabled = true;
      document.getElementById('battlePhaseBtn').disabled = false;
      document.getElementById('endPhaseBtn').disabled = false;
      document.getElementById('setPhaseBtn').classList.remove('active');
      document.getElementById('battlePhaseBtn').classList.add('active');
      addLog('Jawaban tersimpan! Lanjut ke BATTLE PHASE.');
    });

    document.getElementById('cancelAnswer').addEventListener('click', () => {
      document.getElementById('answerModal').classList.remove('active');
    });

    document.getElementById('enterGameBtn').addEventListener('click', () => {
      const introScreen = document.getElementById('introScreen');
      const gameContainer = document.querySelector('.game-container');
      introScreen.classList.add('hidden');
      gameContainer.style.display = 'block';
      setTimeout(() => { introScreen.style.display = 'none'; }, 1000);
    });
    
    // JS UNTUK TOMBOL TUTORIAL
    document.getElementById('openTutorialBtn').addEventListener('click', () => {
        document.getElementById('tutorialModal').classList.add('active');
    });
    
    document.getElementById('closeTutorialBtn').addEventListener('click', () => {
        document.getElementById('tutorialModal').classList.remove('active');
    });

    async function onConfigChange(config) {
      document.getElementById('gameTitle').textContent = config.game_title || defaultConfig.game_title;
      document.getElementById('playerLabel').textContent = config.player_name || defaultConfig.player_name;
      document.getElementById('aiLabel').textContent = config.ai_name || defaultConfig.ai_name;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ["game_title", config.game_title || defaultConfig.game_title],
          ["player_name", config.player_name || defaultConfig.player_name],
          ["ai_name", config.ai_name || defaultConfig.ai_name]
        ])
      });
    }

    updateUI();
  </script>
 </body>
</html>